import{A as T,h as i,B as C,y as Y,D as y,z as M,E as H,o as r,a as m,b as l,t as v,F as x,g as k,j as U,v as w,i as L,m as _,C as N,p as S,f as B}from"./index-VC5NMpas.js";import{h as d}from"./moment-Cl4UOzQZ.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E=c=>(S("data-v-e655b588"),c=c(),B(),c),V={key:0,class:"RoomContainer"},z={class:"RoomHeader"},F=E(()=>l("div",{class:"RoomProfile"},null,-1)),$={class:"RoomName"},j={class:"message"},A={class:"time"},P={class:"RoomInput"},q={class:"inputBox"},G={__name:"DMRoom",setup(c){const h=T(),s=i(null),g=i(!1),u=i(!1),o=i({Room_ID:null,User_Name:null,Messages:[]});C(()=>h.params.Room_ID,a=>{a?(u.value=!0,_.get(`/Direct/print_DM/${a}`).then(e=>{const{ResultRoomChat:t}=e.data;o.value=t,console.log(o.value)}).catch(e=>{const{message:t}=e.response.data;console.log(e.response.status),console.log(t)}).finally(()=>{for(const e of o.value.Messages)e.Time=d(e.Time).format("YYYY:MM:DD HH:mm:ss");s.value.scrollTop=s.value.scrollHeight})):u.value=!1},{immediate:!0});function p(){s.value.scrollTop===0&&f()}function f(){console.log("Loading more messages..."),_.post("/Direct/print_DM_Next",{Room_ID:o.value.Room_ID,Last_Chat:o.value.Messages[0].Message_ID}).then(a=>{console.log(a.data);const{ResultMessages:e}=a.data;console.log(e),o.value.Messages.unshift(...e)}).catch(a=>{console.log(a)})}Y(()=>{s.value&&(s.value.addEventListener("scroll",p),y(()=>{g.value||(s.value.scrollTop=s.value.scrollHeight,g.value=!0)})),M.on("receive_message",async a=>{const{Room_ID:e,User_ID:t,Message:R,Time:I}=a;e===o.value.Room_ID&&(await o.value.Messages.push({Type:"Y",Message:R,Time:I}),s.value.scrollTop=await s.value.scrollHeight)})}),H(()=>{s.value&&s.value.removeEventListener("scroll",p)});const n=i(""),D=()=>{console.log("Sending message..."),_.post("/Direct/send_Message",{Room_ID:o.value.Room_ID,Message:n.value}).then(async a=>{a.data.success&&(await o.value.Messages.push({Type:"M",Message:n.value,Time:d().format("YYYY:MM:DD HH:mm:ss")}),M.emit("send_message",{Room_ID:o.value.Room_ID,User_ID:o.value.User_ID,Message:n.value,Time:d().format("YYYY:MM:DD HH:mm:ss")}),n.value="",s.value.scrollTop=await s.value.scrollHeight)}).catch(a=>{console.log(a)})};return(a,e)=>u.value?(r(),m("div",V,[l("div",z,[F,l("div",$,v(o.value.User_Name),1)]),l("div",{class:"RoomChat",ref_key:"RoomChatContainer",ref:s},[(r(!0),m(x,null,k(o.value.Messages,t=>(r(),m("li",{class:N(t.Type==="M"?"m":"y")},[l("div",j,v(t.Message),1),l("div",A,v(t.Time),1)],2))),256))],512),l("div",P,[l("div",q,[U(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t)},null,512),[[w,n.value]]),l("button",{onClick:e[1]||(e[1]=t=>D())},"send")])])])):L("",!0)}},Q=b(G,[["__scopeId","data-v-e655b588"]]);export{Q as default};
