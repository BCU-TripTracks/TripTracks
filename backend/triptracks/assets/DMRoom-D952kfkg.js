import{A as C,h as i,B as y,y as Y,D as H,z as M,E as k,o as r,a as m,b as l,t as v,F as x,g as U,i as h,j as N,v as w,m as _,C as L,p as S,f as B}from"./index-Ba0hQ8vK.js";import{h as d}from"./moment-Cl4UOzQZ.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const V=c=>(S("data-v-a21858a0"),c=c(),B(),c),b={key:0,class:"RoomContainer"},z={class:"RoomHeader"},F=V(()=>l("div",{class:"RoomProfile"},null,-1)),$={class:"RoomName"},j={class:"message"},A={class:"time"},P={class:"RoomInput"},q={class:"inputBox"},G={__name:"DMRoom",setup(c){const f=C(),o=i(null),g=i(!1),u=i(!1),e=i({Room_ID:null,User_Name:null,Messages:[]});y(()=>f.params.Room_ID,a=>{a?(u.value=!0,_.get(`/Direct/print_DM/${a}`).then(s=>{const{ResultRoomChat:t}=s.data;e.value=t,console.log(e.value)}).catch(s=>{const{message:t}=s.response.data;console.log(s.response.status),console.log(t)}).finally(()=>{if(e.value.Messages.length>0)for(const s of e.value.Messages)s.Time=d(s.Time).format("YYYY:MM:DD HH:mm:ss");o.value.scrollTop=o.value.scrollHeight})):u.value=!1},{immediate:!0});function p(){o.value.scrollTop===0&&D()}function D(){console.log("Loading more messages..."),_.post("/Direct/print_DM_Next",{Room_ID:e.value.Room_ID,Last_Chat:e.value.Messages[0].Message_ID}).then(a=>{console.log(a.data);const{ResultMessages:s}=a.data;console.log(s),e.value.Messages.unshift(...s)}).catch(a=>{console.log(a)})}Y(()=>{o.value&&(o.value.addEventListener("scroll",p),H(()=>{g.value||(o.value.scrollTop=o.value.scrollHeight,g.value=!0)})),M.on("receive_message",async a=>{const{Room_ID:s,User_ID:t,Message:I,Time:T}=a;s===e.value.Room_ID&&(await e.value.Messages.push({Type:"Y",Message:I,Time:T}),o.value.scrollTop=await o.value.scrollHeight)})}),k(()=>{o.value&&o.value.removeEventListener("scroll",p)});const n=i(""),R=()=>{console.log("Sending message..."),_.post("/Direct/send_Message",{Room_ID:e.value.Room_ID,Message:n.value}).then(async a=>{a.data.success&&(await e.value.Messages.push({Type:"M",Message:n.value,Time:d().format("YYYY:MM:DD HH:mm:ss")}),M.emit("send_message",{Room_ID:e.value.Room_ID,User_ID:e.value.User_ID,Message:n.value,Time:d().format("YYYY:MM:DD HH:mm:ss")}),n.value="",o.value.scrollTop=await o.value.scrollHeight)}).catch(a=>{console.log(a)})};return(a,s)=>u.value?(r(),m("div",b,[l("div",z,[F,l("div",$,v(e.value.User_Name?e.value.User_Name:"?"),1)]),l("div",{class:"RoomChat",ref_key:"RoomChatContainer",ref:o},[e.value.Messages?(r(!0),m(x,{key:0},U(e.value.Messages,t=>(r(),m("li",{class:L(t.Type==="M"?"m":"y")},[l("div",j,v(t.Message),1),l("div",A,v(t.Time),1)],2))),256)):h("",!0)],512),l("div",P,[l("div",q,[N(l("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t)},null,512),[[w,n.value]]),l("button",{onClick:s[1]||(s[1]=t=>R())},"send")])])])):h("",!0)}},Q=E(G,[["__scopeId","data-v-a21858a0"]]);export{Q as default};
