import{c as C,r as u,y as q,o as G,a as r,B as J,e as i,f as s,g as M,h as B,t as a,q as m,j as v,D as Q,i as F,F as k,k as w,w as H,m as W,n as X,A as Z,b as ee,d as n,p as se,v as te,x as oe,u as le,C as ae}from"./index-Cp1J-Kyg.js";import{s as ne,l as ie,a as ce}from"./likeed-v1A9XkUo.js";import{P as re,N as ue,S as de,a as _e}from"./pagination-BeehCn9_.js";import{h as P}from"./moment-C5S46NFB.js";import{S as p}from"./sweetalert2.esm.all-D3pEHXw3.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe="/assets/404img-CbatP5_C.avif",ve={class:"feedinfobox"},fe=["src"],he={class:"commentdetail"},ge={class:"username"},Ce={class:"sub"},ke={class:"uploadtime"},we={class:"userbutton"},De={key:0,class:"Ownerbox"},Ie={key:1,class:"Audiencebox"},ye={class:"slidewrapContainer"},be={class:"slidewrap"},xe=["src","data-fallback"],Be={class:"interact"},Fe={class:"Title"},Pe={class:"caption"},Ue={class:"tagzone"},Te={class:"place"},Se={class:"makerdrop"},Le={class:"LCS"},Me={class:"LC"},He=["src"],Ye=["src"],Re={class:"commentdetail"},Ee={class:"username"},Ne={class:"content"},Ve={class:"sub"},$e={class:"uploadtime"},Ae=["onClick"],ze={class:"commentcontainer"},Ke={__name:"FeedDetail",setup(Oe){const D=Z(),U=oe(),f=le(),Y=C(()=>f.state.isModify),R=C(()=>D.params.Post_ID),I=C(()=>f.state.User_ID),E=u({}),o=u(null),y=u(null),c=u(null);u(null);const T=u(!1),h=C(()=>o.value&&I.value===o.value.post.User_ID);q(Y,()=>{r.get(`/Feeds/Post_detail/${R.value}`,{withCredentials:!0}).then(e=>{o.value=e.data,c.value&&(c.value.addEventListener("scroll",L),ae(()=>{T.value||(c.value.scrollTop=c.value.scrollHeight,T.value=!0)}))}).catch(e=>{console.log("오류 발생:",e),console.log(result)})},{immediate:!0});const N=()=>{f.commit("Switch_isModify")},V=async()=>{await r.post("/Direct/search_Room",{toUser_ID:E.value.User_ID},{withCredentials:!0}).then(e=>{console.log(e.data);const{Room_ID:t}=e.data;U.push({name:"Room",params:{Room_ID:t}})}).catch(e=>{console.log(e)})},$=()=>{o.value.isFollowedByCurrentUser&&p.fire({title:"정말 팔로우를 취소하시겠습니까?",text:" ",icon:"warning",showCancelButton:!0,confirmButtonText:"팔로우 취소",cancelButtonText:"취소"}).then(async e=>{e.isConfirmed&&await r.post("/user/unfollow",{userId:o.value.post.User_ID},{withCredentials:!0}).then(t=>{console.log(t.data),p.fire("팔로우 취소","팔로우가 취소되었습니다.","success"),f.commit("Update_Follow_Status",!1)}).catch(t=>{console.log(t)})})},A=async()=>{p.fire({title:"정말로 게시글을 삭제하시겠습니까?",text:"삭제된 게시글은 되돌릴 수 없습니다.",icon:"warning",showCancelButton:!0,confirmButtonText:"삭제",cancelButtonText:"취소"}).then(async e=>{e.isConfirmed?await r.post("/feeds/Post_delete",{postId:o.value.post.Post_ID},{withCredentials:!0}).then(t=>{console.log(t.data),p.fire("게시글이 삭제되었습니다!","홈화면으로 이동합니다.","success"),o.value=null,U.push({name:"HomeFeed"})}).catch(t=>{console.log(t)}):e.dismiss===p.DismissReason.cancel&&p.fire("게시글 삭제가 취소되었습니다.","ㅋㅋ봐줌","error")})},g=u(""),b=u([]),x=()=>{r.post("/feeds/Comment/list",{Post_ID:o.value.post.Post_ID},{withCredentials:!0}).then(e=>{b.value=e.data,console.log(e.data)}).catch(e=>{console.log("오류발생"),console.log(e)})},S=()=>{P().format("YYYY년 MM월 DD일 HH:mm"),r.post("/feeds/Comment/add",{Post_ID:o.value.post.Post_ID,Comment:g.value},{withCredentials:!0}).then(e=>{console.log(e.data),x()}).catch(e=>{console.log("오류발생"),console.log(e)}),g.value=""},z=e=>{e.User_ID===I.value&&p.fire({title:"정말 코멘트를 지우겠습니까?",text:" ",icon:"warning",showCancelButton:!0,confirmButtonText:"코멘트 삭제",cancelButtonText:"취소"}).then(async t=>{t.isConfirmed&&r.post("/feeds/Comment/delete",{Comment_ID:e.Comment_ID},{withCredentials:!0}).then(d=>{console.log(d.data),x()}).catch(d=>{console.log("오류발생"),console.log(d)})})};u(null),G(()=>{console.log("테스트1"),console.log(D.params.Post_ID),r.get("/Feeds/Post_detail/"+D.params.Post_ID,{withCredentials:!0}).then(async e=>{o.value=e.data,y.value=e.data.locations.map(t=>t.name),console.log(y.post),x()}).catch(e=>{console.log("오류발생"),console.log(e)})});const K=e=>{e.isLike?r.post("/feeds/Like/remove",{postId:e.Post_ID},{withCredentials:!0}).then(t=>{e.isLike=!e.isLike}).catch(t=>{t.response.status==400}):r.post("/feeds/Like/add",{postId:e.Post_ID},{withCredentials:!0}).then(t=>{e.isLike=!e.isLike}).catch(t=>{t.response.status==400})},O=e=>{e.target.src=e.target.getAttribute("data-fallback")},j=[re,ue];J(()=>{c.value&&c.value.removeEventListener("scroll",L)});function L(){const e=c.value.scrollTop,t=c.value.scrollHeight,d=c.value.clientHeight;console.log(e,d,t),e+d>=t&&(console.log("맨 아래 도달"),loadMorePosts())}return(e,t)=>{const d=ee("router-link");return o.value?(n(),i("div",{key:0,ref_key:"Feedcontainer",ref:c,class:"discription"},[s("div",ve,[s("img",{src:o.value.post.Profile_Img,alt:"",class:"profile"},null,8,fe),s("div",he,[s("div",null,[s("span",ge,[M(d,{to:{name:"PersonalPage",params:{User_ID:o.value.post.User_ID}},class:"userID"},{default:B(()=>[F(a(o.value.post.User_ID),1)]),_:1},8,["to"])])]),s("div",Ce,[s("span",ke,a(m(P)(o.value.post.Post_Create_Timestamp).format("YYYY년 MM월 DD일 HH:mm")),1)])]),s("div",we,[h.value?(n(),i("div",De,[s("button",{onClick:t[0]||(t[0]=l=>N()),class:"modifybutton"}," 수정 "),s("button",{class:"feeddelete",onClick:A},"삭제")])):v("",!0),h.value?v("",!0):(n(),i("div",Ie)),h.value?v("",!0):(n(),i("button",{key:2,class:"follow",onClick:$,style:Q({backgroundColor:o.value.isFollowedByCurrentUser?"#EFEFEF":"black",borderColor:o.value.isFollowedByCurrentUser?"#F2F2F2":"black",color:o.value.isFollowedByCurrentUser?"black":"white"})},a(o.value.isFollowedByCurrentUser?"팔로잉":"팔로우"),5)),h.value?v("",!0):(n(),i("button",{key:3,class:"message",onClick:V}," 메시지 "))])]),s("div",ye,[s("div",be,[M(m(_e),{ref:"swiperRef",init:"false",spaceBetween:1,slidesPerView:1,pagination:!0,navigation:!0,modules:j,class:"mySwiper"},{default:B(()=>[(n(!0),i(k,null,w(o.value.post.Image_Srcs,(l,_)=>(n(),se(m(de),{key:_},{default:B(()=>[s("img",{src:l,onError:O,"data-fallback":m(pe),alt:"Image preview"},null,40,xe)]),_:2},1024))),128))]),_:1},512)]),s("div",null,[s("div",Be,[s("div",Fe,a(o.value.post.Post_Title),1),s("div",Pe,a(o.value.post.Post_Caption),1)])])]),s("ul",Ue,[t[3]||(t[3]=F(" Tag : ")),(n(!0),i(k,null,w(o.value.tags,(l,_)=>(n(),i("li",{class:"tag",key:_},a(l),1))),128))]),s("ul",Te,[t[4]||(t[4]=F(" Locate : ")),(n(!0),i(k,null,w(y.value,(l,_)=>(n(),i("li",{class:"tag",key:_},a(l),1))),128))]),s("ul",Se,[s("li",Le,[s("span",Me,"좋아요 "+a(o.value.post.likeCount)+" 댓글 "+a(b.value.length),1),s("span",null,[s("img",{src:o.value.post.isLike?m(ie):m(ce),alt:"",class:"like",onClick:t[1]||(t[1]=l=>K(o.value.post))},null,8,He)]),t[5]||(t[5]=s("span",null,[s("img",{src:ne,alt:"",class:"save"})],-1))])]),(n(!0),i(k,null,w(b.value,(l,_)=>(n(),i("div",{key:_,class:"commentbox"},[s("span",null,[s("img",{src:l.Profile_Img,alt:"",class:"profile"},null,8,Ye)]),s("div",Re,[s("div",null,[s("span",Ee," @"+a(l.User_ID)+"-"+a(l.User_Name),1),s("span",Ne,a(l.Comment_Text),1)]),s("div",Ve,[s("span",$e,a(m(P)(l.Comment_Timestamp).format("YYYY년MM월DD일 HH:mm:ss")),1),H(s("span",{class:"reply",onClick:je=>z(l)},"삭제",8,Ae),[[te,l.User_ID===I.value]])])])]))),128)),s("div",ze,[H(s("input",{class:"comment",type:"text",placeholder:"댓글을 입력하세요.","onUpdate:modelValue":t[2]||(t[2]=l=>g.value=l),onKeypress:X(S,["enter"])},null,544),[[W,g.value]]),s("button",{class:"commenting",onClick:S},"입력")])],512)):v("",!0)}}},Ze=me(Ke,[["__scopeId","data-v-4faf489b"]]);export{Ze as default};
