import{c as C,r as d,y as j,o as q,a as c,B as z,e as r,f as s,g as S,h as y,t as a,q as _,j as v,D as G,F as x,k as b,w as L,m as J,n as Q,A as W,b as X,d as n,i as Z,p as ee,v as se,x as te,u as oe,C as le}from"./index-HUFp0Dkx.js";import{s as ae,l as ne}from"./like-Cq13m2ZL.js";import{P as ie,N as ce,S as re,a as ue}from"./pagination-CMOR0lCz.js";import{h as B}from"./moment-C5S46NFB.js";import{S as m}from"./sweetalert2.esm.all-D3pEHXw3.js";import{l as de}from"./likeed-BS52KISc.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me="/assets/404img-CbatP5_C.avif",pe={class:"feedinfobox"},ve=["src"],fe={class:"commentdetail"},he={class:"username"},ge={class:"sub"},Ce={class:"uploadtime"},ke={class:"userbutton"},we={key:0,class:"Ownerbox"},De={key:1,class:"Audiencebox"},Ie={class:"slidewrapContainer"},ye={class:"slidewrap"},xe=["src","data-fallback"],be={class:"interact"},Be={class:"Title"},Fe={class:"caption"},Pe={class:"place"},Ue={class:"makerdrop"},Te={class:"LCS"},Se={class:"LC"},Le=["src"],Me=["src"],He={class:"commentdetail"},Ye={class:"username"},Re={class:"content"},Ee={class:"sub"},Ne={class:"uploadtime"},Ve=["onClick"],$e={class:"commentcontainer"},Ae={__name:"FeedDetail",setup(Ke){const k=W(),F=te(),f=oe(),M=C(()=>f.state.isModify),H=C(()=>k.params.Post_ID),w=C(()=>f.state.User_ID),Y=d({}),o=d(null),i=d(null);d(null);const P=d(!1),h=C(()=>o.value&&w.value===o.value.post.User_ID);j(M,()=>{c.get(`/Feeds/Post_detail/${H.value}`,{withCredentials:!0}).then(e=>{o.value=e.data,i.value&&(i.value.addEventListener("scroll",T),le(()=>{P.value||(i.value.scrollTop=i.value.scrollHeight,P.value=!0)}))}).catch(e=>{console.log("오류 발생:",e),console.log(result)})},{immediate:!0});const R=()=>{f.commit("Switch_isModify")},E=async()=>{await c.post("/Direct/search_Room",{toUser_ID:Y.value.User_ID},{withCredentials:!0}).then(e=>{console.log(e.data);const{Room_ID:t}=e.data;F.push({name:"Room",params:{Room_ID:t}})}).catch(e=>{console.log(e)})},N=()=>{o.value.isFollowedByCurrentUser&&m.fire({title:"정말 팔로우를 취소하시겠습니까?",text:" ",icon:"warning",showCancelButton:!0,confirmButtonText:"팔로우 취소",cancelButtonText:"취소"}).then(async e=>{e.isConfirmed&&await c.post("/user/unfollow",{userId:o.value.post.User_ID},{withCredentials:!0}).then(t=>{console.log(t.data),m.fire("팔로우 취소","팔로우가 취소되었습니다.","success"),f.commit("Update_Follow_Status",!1)}).catch(t=>{console.log(t)})})},V=async()=>{m.fire({title:"정말로 게시글을 삭제하시겠습니까?",text:"삭제된 게시글은 되돌릴 수 없습니다.",icon:"warning",showCancelButton:!0,confirmButtonText:"삭제",cancelButtonText:"취소"}).then(async e=>{e.isConfirmed?await c.post("/feeds/Post_delete",{postId:o.value.post.Post_ID},{withCredentials:!0}).then(t=>{console.log(t.data),m.fire("게시글이 삭제되었습니다!","홈화면으로 이동합니다.","success"),o.value=null,F.push({name:"HomeFeed"})}).catch(t=>{console.log(t)}):e.dismiss===m.DismissReason.cancel&&m.fire("게시글 삭제가 취소되었습니다.","ㅋㅋ봐줌","error")})},g=d(""),D=d([]),I=()=>{c.post("/feeds/Comment/list",{Post_ID:o.value.post.Post_ID},{withCredentials:!0}).then(e=>{D.value=e.data,console.log(e.data)}).catch(e=>{console.log("오류발생"),console.log(e)})},U=()=>{B().format("YYYY년 MM월 DD일 HH:mm"),c.post("/feeds/Comment/add",{Post_ID:o.value.post.Post_ID,Comment:g.value},{withCredentials:!0}).then(e=>{console.log(e.data),I()}).catch(e=>{console.log("오류발생"),console.log(e)}),g.value=""},$=e=>{e.User_ID===w.value&&m.fire({title:"정말 코멘트를 지우겠습니까?",text:" ",icon:"warning",showCancelButton:!0,confirmButtonText:"코멘트 삭제",cancelButtonText:"취소"}).then(async t=>{t.isConfirmed&&c.post("/feeds/Comment/delete",{Comment_ID:e.Comment_ID},{withCredentials:!0}).then(u=>{console.log(u.data),I()}).catch(u=>{console.log("오류발생"),console.log(u)})})};d(null),q(()=>{console.log("테스트1"),console.log(k.params.Post_ID),c.get("/Feeds/Post_detail/"+k.params.Post_ID,{withCredentials:!0}).then(async e=>{o.value=e.data,console.log(o.post),I()}).catch(e=>{console.log("오류발생"),console.log(e)})});const A=e=>{e.isLike?c.post("/feeds/Like/remove",{postId:e.Post_ID},{withCredentials:!0}).then(t=>{e.isLike=!e.isLike}).catch(t=>{t.response.status==400}):c.post("/feeds/Like/add",{postId:e.Post_ID},{withCredentials:!0}).then(t=>{e.isLike=!e.isLike}).catch(t=>{t.response.status==400})},K=e=>{e.target.src=e.target.getAttribute("data-fallback")},O=[ie,ce];z(()=>{i.value&&i.value.removeEventListener("scroll",T)});function T(){const e=i.value.scrollTop,t=i.value.scrollHeight,u=i.value.clientHeight;console.log(e,u,t),e+u>=t&&(console.log("맨 아래 도달"),loadMorePosts())}return(e,t)=>{const u=X("router-link");return o.value?(n(),r("div",{key:0,ref_key:"Feedcontainer",ref:i,class:"discription"},[s("div",pe,[s("img",{src:o.value.post.Profile_Img,alt:"",class:"profile"},null,8,ve),s("div",fe,[s("div",null,[s("span",he,[S(u,{to:{name:"PersonalPage",params:{User_ID:o.value.post.User_ID}},class:"userID"},{default:y(()=>[Z(a(o.value.post.User_ID),1)]),_:1},8,["to"])])]),s("div",ge,[s("span",Ce,a(_(B)(o.value.post.Post_Create_Timestamp).format("YYYY년 MM월 DD일 HH:mm")),1)])]),s("div",ke,[h.value?(n(),r("div",we,[s("button",{onClick:t[0]||(t[0]=l=>R()),class:"modifybutton"}," 수정 "),s("button",{class:"feeddelete",onClick:V},"삭제")])):v("",!0),h.value?v("",!0):(n(),r("div",De)),h.value?v("",!0):(n(),r("button",{key:2,class:"follow",onClick:N,style:G({backgroundColor:o.value.isFollowedByCurrentUser?"#EFEFEF":"black",borderColor:o.value.isFollowedByCurrentUser?"#F2F2F2":"black",color:o.value.isFollowedByCurrentUser?"black":"white"})},a(o.value.isFollowedByCurrentUser?"팔로잉":"팔로우"),5)),h.value?v("",!0):(n(),r("button",{key:3,class:"message",onClick:E}," 메시지 "))])]),s("div",Ie,[s("div",ye,[S(_(ue),{ref:"swiperRef",init:"false",spaceBetween:1,slidesPerView:1,pagination:!0,navigation:!0,modules:O,class:"mySwiper"},{default:y(()=>[(n(!0),r(x,null,b(o.value.post.Image_Srcs,(l,p)=>(n(),ee(_(re),{key:p},{default:y(()=>[s("img",{src:l,onError:K,"data-fallback":_(me),alt:"Image preview"},null,40,xe)]),_:2},1024))),128))]),_:1},512)]),s("div",null,[s("div",be,[s("div",Be,a(o.value.post.Post_Title),1),s("div",Fe,a(o.value.post.Post_Caption),1)])])]),s("ul",Pe,[(n(!0),r(x,null,b(o.value.tags,(l,p)=>(n(),r("li",{class:"tag",key:p}," #"+a(l),1))),128))]),s("ul",Ue,[s("li",Te,[s("span",Se,"좋아요 "+a(o.value.post.likeCount)+" 댓글 "+a(D.value.length),1),s("span",null,[s("img",{src:o.value.post.isLike?_(de):_(ne),alt:"",class:"like",onClick:t[1]||(t[1]=l=>A(o.value.post))},null,8,Le)]),t[3]||(t[3]=s("span",null,[s("img",{src:ae,alt:"",class:"save"})],-1))])]),(n(!0),r(x,null,b(D.value,(l,p)=>(n(),r("div",{key:p,class:"commentbox"},[s("span",null,[s("img",{src:l.Profile_Img,alt:"",class:"profile"},null,8,Me)]),s("div",He,[s("div",null,[s("span",Ye," @"+a(l.User_ID)+"-"+a(l.User_Name),1),s("span",Re,a(l.Comment_Text),1)]),s("div",Ee,[s("span",Ne,a(_(B)(l.Comment_Timestamp).format("YYYY년MM월DD일 HH:mm:ss")),1),L(s("span",{class:"reply",onClick:Oe=>$(l)},"삭제",8,Ve),[[se,l.User_ID===w.value]])])])]))),128)),s("div",$e,[L(s("input",{class:"comment",type:"text",placeholder:"댓글을 입력하세요.","onUpdate:modelValue":t[2]||(t[2]=l=>g.value=l),onKeypress:Q(U,["enter"])},null,544),[[J,g.value]]),s("button",{class:"commenting",onClick:U},"입력")])],512)):v("",!0)}}},Xe=_e(Ae,[["__scopeId","data-v-d0008d88"]]);export{Xe as default};
