import{r as n,c as f,y as F,o as E,a as p,e as o,f as s,F as h,k as y,j as m,g as I,d as i,h as T,t as A,x as L,u as R,C as U,b as $}from"./index-DPOt7a1X.js";import{P as V}from"./ProfileImage-B4Awu9kj.js";import G from"./planning-C1oUmy4Z.js";import{S as u}from"./sweetalert2.esm.all-D3pEHXw3.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CZnAS8i4.js";const X={class:"container"},q={key:0,class:"sub"},z={class:"feedSlider"},H=["src"],J={key:1,class:"map"},K={key:2,class:"sub"},O={class:"plan-header"},Q=["onClick"],W=["onClick"],Y={__name:"planner",setup(Z){const D=L(),d=R(),l=n("saved");n(""),n([]),n(null);const P=n(V);f(()=>d.state.isMsg),n(""),n(null),n(null);const k=n([]),v=n([]),_=n([]),C=f(()=>d.state.planningID),S=()=>{p.get("/feeds/my_plan",{withCredentials:!0}).then(e=>{Array.isArray(e.data.plan)?(console.log("plans array received:",e.data.plan),_.value=e.data.plan.map(a=>({planning_ID:a.planning_ID,planning_title:a.planning_title,User_ID:a.User_ID}))):console.warn("Plans response is not an array:",e.data.plan)}).catch(e=>{console.error("Failed to load plans:",e)})},w=async e=>{u.fire({title:"정말로 계획을 삭제하시겠습니까?",text:"삭제된 계획은 되돌릴 수 없습니다.",icon:"warning",showCancelButton:!0,confirmButtonText:"삭제",cancelButtonText:"취소"}).then(async a=>{if(a.isConfirmed)try{await p.post("/feeds/Plan_delete",{planning_ID:_.value[e].planning_ID},{withCredentials:!0}),u.fire("계획이 삭제되었습니다!","홈화면으로 이동합니다.","success"),D.push({name:"planner"})}catch(r){console.log("Failed to delete plan:",r),u.fire("삭제 실패","계획 삭제에 실패했습니다.","error")}else a.dismiss===u.DismissReason.cancel&&u.fire("게시글 삭제가 취소되었습니다.","삭제가 취소되었습니다.","error")})},g=()=>{p.post("/Feeds/Ambass_Save_List",{User_ID:d.state.User_ID},{withCredentials:!0}).then(e=>{console.log("Saved Posts:",e.data),v.value=e.data}).catch(e=>{console.log(e)})},x=async e=>{d.commit("SET_PLANNINGID",e),await U(),l.value="planning"},N=()=>{l.value="saved",g()},b=()=>{d.commit("SET_PLANNINGID",null),l.value="planning"},M=()=>{l.value="myplan",S()};return F(()=>C.value,async e=>{if(e){console.log("planning.vue - Received Planning_ID:",e);try{const a=await p.get(`/feeds/my_plan_detail/${e}`,{withCredentials:!0});console.log("planning.vue - API Response:",a.data);const r=a.data.planning;if(!r){console.error("Planning data is undefined or null");return}title.value=r.planning_title||"",travelDays.value=r.travelDays.map(t=>({day:`Day ${t.day}`,places:t.places.map(c=>({place_name:c.place_name,address:c.address||"주소 정보 없음",y:c.y,x:c.x}))})),currentDay.value=1}catch(a){console.error("Error fetching planning data:",a)}}},{immediate:!0}),E(()=>{l.value="saved",g(),p.get("/profile/profile_load",{withCredentials:!0}).then(e=>{k.value=e.data,P.value=e.data.Profile_Img}).catch(e=>{console.log(e)})}),(e,a)=>{const r=$("router-link");return i(),o("div",X,[s("div",{class:"submenu"},[s("span",{class:"saved",onClick:N},"Saved"),s("span",{class:"planning",onClick:b},"Planning"),s("span",{class:"myplan",onClick:M},"My Plan")]),l.value==="saved"?(i(),o("div",q,[s("div",z,[(i(!0),o(h,null,y(v.value,t=>(i(),o("div",{class:"grid-article",key:t.Post_ID},[I(r,{to:{name:"FeedDetail",params:{Post_ID:t.Post_ID}}},{default:T(()=>[s("img",{src:t.Image_Src,alt:"",class:"Eximage"},null,8,H)]),_:2},1032,["to"])]))),128))])])):m("",!0),l.value==="planning"?(i(),o("div",J,[I(G)])):m("",!0),l.value==="myplan"?(i(),o("div",K,[(i(!0),o(h,null,y(_.value,(t,c)=>(i(),o("div",{key:c,class:"plan-card"},[s("span",O,[s("h3",{class:"plan-title",onClick:B=>x(t.planning_ID)},A(t.planning_title),9,Q),s("button",{onClick:B=>w(c),class:"remove-plan-btn"},"X",8,W)])]))),128))])):m("",!0)])}}},oe=j(Y,[["__scopeId","data-v-987c9153"]]);export{oe as default};
